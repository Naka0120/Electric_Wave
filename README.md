# 1次元電磁波伝搬シミュレーション解説

このプログラムは、FDTD法（Finite-Difference Time-Domain method、時間領域差分法）を用いて、1次元空間における電磁波の伝搬をシミュレーションします。

## 1. 物理モデル

マクスウェルの方程式（1次元、真空中の場合）を解きます。
電界 $E_y$ と磁束密度 $B_z$ のみを考え、x方向に変化するものとします（平面波近似）。

### 支配方程式
**ファラデーの法則**:
$$ \frac{\partial B_z}{\partial t} = -\frac{\partial E_y}{\partial x} $$

**アンペールの法則**:
$$ \frac{\partial E_y}{\partial t} = -c^2 \frac{\partial B_z}{\partial x} - \frac{1}{\epsilon_0} J_y $$

ここで、
-   $c$: 光速 (プログラム設定値: 10.0)
-   $\epsilon_0$: 真空の誘電率 (プログラム設定値: 1.0)
-   $J_y$: 電流密度

## 2. 数値計算法 (FDTD法)

空間と時間を離散化して計算します。
-   **空間**: 格子点数 $N_x=400$ ($x = i \cdot \Delta x$)
-   **時間**: ステップ $n$ ($t = n \cdot \Delta t$)

$E_y$ と $B_z$ を空間的・時間的に半歩ずらして配置する **Yee格子** を採用しています。

### 更新式
以下は、課題スライドに示された更新式に対応します。

1.  **磁場の更新** ($n \to n+1/2$):
    $$ B_{z}^{n+1/2}[i] = B_{z}^{n-1/2}[i] - \frac{\Delta t}{\Delta x} (E_y^n[i+1] - E_y^n[i]) $$

2.  **電場の更新** ($n+1/2 \to n+1$):
    $$ E_y^{n+1}[i] = E_y^n[i] + \Delta t \left( -c^2 \frac{B_{z}^{n+1/2}[i] - B_{z}^{n+1/2}[i-1]}{\Delta x} - J_y^{n+1/2}[i] / \epsilon_0 \right) $$

### 電流源（アンテナ）の設定 ($J_y$)
シミュレーション領域内に電磁波の源を与えます。電流を励振しないと、電磁波が発生しません。
プログラムでは、空間的に配列 `jy` を定義し、シミュレーション領域の中央だけ、人為的に `jy` を時間変化させます。

-   **空間分布**: 中央の格子点（$i=200$）のみ値を持ち、他は常に0とします。
-   **時間変化**: $jy(200)$ に任意の時間関数を与えます。
    -   例: 角周波数 $\omega=5.0$、定数 $J_0$ として、$J_y = J_0 \sin(\omega t)$
    -   $t$ は $\Delta t$ に経過時間ステップ数をかけたものです。

## 3. シミュレーション条件と物理量の確認

| パラメータ | 値 | 説明 |
| :--- | :--- | :--- |
| **空間格子数 ($N_x$)** | 400 | 計算領域の広さ |
| **格子間隔 ($\Delta x$)** | 1.0 | 空間分解能 |
| **光速 ($c$)** | 10.0 | |
| **誘電率 ($\epsilon_0$)** | 1.0 | |
| **角周波数 ($\omega$)** | 5.0 | 励振源の角周波数 |

### 結果の確認
シミュレーション結果から、以下の物理パラメータが設定通りか確認します。
-   **周期 ($T$)**: $T = 2\pi / \omega = 2\pi / 5.0 \approx 1.257$
-   **波長 ($\lambda$)**: $\lambda = c / f = c \cdot T \approx 12.57$
-   **伝搬速度 ($v$)**: $v = c = 10.0$

## 4. プログラムの実行方法と結果

### 実行コマンド
```powershell
python em_1d_sim.py
```

### 結果の可視化
`results_stable` ディレクトリに、電磁波伝搬のスナップショット `ey_propagation_dt0.5.png` が生成されます。
中央から正弦波が発生し、左右へ伝搬していく様子（および端での反射）が確認できます。

### 物理量の検証
物理モデルが正しく計算されているか確認するために、以下の検証スクリプトを実行してください。

```powershell
python verify_physics_plot.py
```

これにより `verification_plot.png` が生成されます。
-   **上段**: 時間波形から**周期 ($T \approx 1.26$)** を確認。
-   **下段**: 空間波形から**波長 ($\lambda \approx 12.6$)** を確認。
-   これらから算出される速度が $c=10.0$ と一致することを確認しています。
