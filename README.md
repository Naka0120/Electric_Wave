# 1次元電磁波伝搬シミュレーション解説

このプログラムは、FDTD法（Finite-Difference Time-Domain method、時間領域差分法）を用いて、1次元空間における電磁波の伝搬をシミュレーションします。

## 1. 物理モデル

マクスウェルの方程式（1次元、真空中の場合）を解きます。
電界 $E_y$ と磁束密度 $B_z$ のみを考え、x方向に変化するものとします（平面波近似）。

### 支配方程式
**ファラデーの法則**:
$$ \frac{\partial B_z}{\partial t} = -\frac{\partial E_y}{\partial x} $$

**アンペールの法則**:
$$ \frac{\partial E_y}{\partial t} = -c^2 \frac{\partial B_z}{\partial x} - \frac{1}{\epsilon_0} J_y $$

ここで、
-   $c$: 光速 (プログラム設定値: 10.0)
-   $\epsilon_0$: 真空の誘電率 (プログラム設定値: 1.0)
-   $J_y$: 電流源（正弦波励振）

## 2. 数値計算法 (FDTD法)

空間と時間を離散化して計算します。
-   **空間**: 格子点 $i$ ($x = i \cdot \Delta x$)
-   **時間**: ステップ $n$ ($t = n \cdot \Delta t$)

$E_y$ と $B_z$ を空間的・時間的に半歩ずらして配置する **Yee格子（リープフロッグ法）** を採用しています。

### 更新式
1.  **磁場の更新** ($n \to n+1/2$):
    $$ B_z^{n+1/2}[i] = B_z^{n-1/2}[i] - \frac{\Delta t}{\Delta x} (E_y^n[i+1] - E_y^n[i]) $$

2.  **電場の更新** ($n+1/2 \to n+1$):
    $$ E_y^{n+1}[i] = E_y^n[i] - c^2 \frac{\Delta t}{\Delta x} (B_z^{n+1/2}[i] - B_z^{n+1/2}[i-1]) - \frac{\Delta t}{\epsilon_0} J_y $$

## 3. シミュレーション条件

| パラメータ | 値 | 説明 |
| :--- | :--- | :--- |
| **空間格子数 ($N_x$)** | 400 | 計算領域の広さ |
| **格子間隔 ($\Delta x$)** | 1.0 | 空間分解能 |
| **光速 ($c$)** | 10.0 | モデル上の伝搬速度 |
| **誘電率 ($\epsilon_0$)** | 1.0 | モデル上の誘電率 |
| **励振源** | 正弦波 | 領域中央($x=200$)で電流を注入 |

### 境界条件
**完全導体 (PEC: Perfect Electric Conductor)**
領域の両端 ($x=0, x=400$) で $E_y = 0$ と固定しています。これにより、電磁波は壁で反射します。

### 数値安定性条件 (CFL条件)
FDTD法が安定して計算できるためには、時間刻み $\Delta t$ は以下の条件（クーラン条件）を満たす必要があります。

$$ c \Delta t \le \Delta x $$

すなわち、1ステップに進む距離 $c \Delta t$ が、格子間隔 $\Delta x$ を超えてはいけません。
本プログラムでは、$\Delta t = 0.5 \times (\Delta x / c)$ を標準として使用しています。

## 4. プログラムの実行方法

コンソールで以下のコマンドを実行してください。

```powershell
python em_1d_sim.py
```

### 出力結果
プログラムを実行すると、以下のディレクトリが作成され、グラフが保存されます。

1.  **`results_stable/`** (安定条件: $\Delta t=0.05$)
    -   `ey_propagation_dt0.5.png`: 電磁波が中央から広がり、両端で反射する様子。
    -   `verification_dt0.5.txt`: 伝搬速度、周期、波長の検証結果。

2.  **`results_unstable/`** (不安定条件: $\Delta t=0.101$)
    -   $\Delta t$ を意図的に大きくしてCFL条件を破ったケース。
    -   数値発散により、計算結果が崩壊する様子が確認できます。

## 5. 結果の検証
理論値とシミュレーション結果（波形の周期や波長）を比較し、物理モデルが正しく計算されていることを確認済みです。
-   設定した波長 $\lambda = 40.0$ に対し、周期 $T = \lambda / c = 4.0$ となります。
-   シミュレーション結果からも、周期 約4.0 が確認されました。
